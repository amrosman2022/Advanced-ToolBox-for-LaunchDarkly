<!-- this file is called only on the first instance of running the system and used to create the settings file-->
<!DOCTYPE html>
<html lang="en" class="light-style layout-footer-fixed layout-menu-collapsed" dir="ltr" data-theme="theme-default"
  data-assets-path="./assets/" data-template="vertical-menu-template-starter">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>

  <title>ToolBox4LD</title>

  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="./assets/img/favicon/favicon.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" />

  <!-- Icons. Uncomment required icon fonts -->
  <link rel="stylesheet" href="./assets/vendor/fonts/boxicons.css" />
  <!-- <link rel="stylesheet" href="./assets/vendor/fonts/fontawesome.css" /> -->
  <!-- <link rel="stylesheet" href="./assets/vendor/fonts/flag-icons.css" /> -->

  <!-- Core CSS -->
  <link rel="stylesheet" href="./assets/vendor/css/core.css" />
  <link rel="stylesheet" href="./assets/vendor/css/theme-default.css" />
  <link rel="stylesheet" href="./assets/css/demo.css" />

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

  <!-- Helpers -->
  <script src="./assets/vendor/js/helpers.js"></script>
  <script src="./common/commonH.js"></script>

  
  <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
  <script src="./assets/js/config.js"></script>

</head>

<script>

var s_srchPairs = '';
var bol_idChanged = false;
var bol_formSaved = false;


//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
function func_regexFind(s_srcText,n_mode, str_updateObj='')
{
  // Regular expression to match text between "//" and ":"
  switch (n_mode)
  {
    case 1:
      var regex = /\/\/(.*?):/g;
      break;
    case 2:
      var regex = /:(.*?@)/g;
      break;
  }

  var matches = s_srcText.match(regex);
  if (matches) {
      for (var i = 0; i < matches.length; i++) {
          var match = matches[i];
          // Remove "//" and ":" from the match
          (n_mode==2)?extractedText=match.split(':')[2].substring(match.split(':')[2].length-1,0):match;
          (n_mode==1)?extractedText = match.slice(2, -1): match ;
          console.log(extractedText);
          if (str_updateObj.length>0)
          {
            document.getElementById(str_updateObj).value = extractedText;
          }
          return extractedText;
      }
  } else {
      func_ShowAlert("DB Connection does not contain user name and password. Please validate DB Connection format.",true);
      return '';
  }

}

//-----------------------------------------------------------
//-----------Read the values from the Settings File----------
//-----------------------------------------------------------
const func_LoadValues = async () => 
{
    // ------ Start fetching the data
    try
      {
        const response = await fetch('http://localhost:8080/settings|||2|||' + s_srchPairs);
        const myJson = await response.json(); //extract TEXT from the http response
        if (JSON.parse(myJson[0])['ErrorCode']!=0)
        {
          (JSON.parse(myJson[0])['Message']);
        }
        else
        {
          formFields = myJson[1];
          let x = JSON.stringify(formFields);
          let y = JSON.parse(x);

          document.getElementById('incl_ASlogging').value = y.incl_ASlogging;
          document.getElementById('incl_ASpassword_1').value = y.incl_ASpassword_1;
          document.getElementById('incl_ASuser_nameAS').value = y.incl_ASuser_nameAS;
          document.getElementById('incl_DBconnection').value = y.incl_DBconnection;
          document.getElementById('incl_LDkey').value = y.incl_LDkey;
          document.getElementById('incl_LDkeyname').value = y.incl_LDkeyname;
        }
      }
      catch
      {
        func_ShowAlert('Server not Running, Please Start the Python Advanced ToolBox Server...', true);
      }
    

}


//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
function text_encode (s)
{
  try 
  {
    replacementString = s.replace(/\//g, "*|*");
    replacementString = replacementString.replace(/\?/g, "_-|x|-_");
    return replacementString;
  }
  catch
  {
    return s;
  }
}


//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
const func_saveSettings = async () => 
{
    // ------ Start fetching the data
    try
    {
      s_url = 'http://localhost:8080/settings|||1|||' + text_encode(s_srchPairs);    // encode text to Base64 to remove special characters ex:/ that fails the URL
      const response = await fetch(s_url);
      const myJson = await response.json(); //extract TEXT from the http response
      if (JSON.parse(myJson[0])['ErrorCode']!=0)
      {
        func_ShowAlert(JSON.parse(myJson[0])['Message'],true);
      }
      else
      {
        bol_formSaved = true;
        alert('Settings Saved');
        window.open('index.html','_self');
        //func_ShowAlert('Settings Saved', true);
      }
    }
    catch (error)
    {
      func_ShowAlert(error.message, true);
    }
    

}


//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
function validate_form(formID)
{
  s_srchPairs = '';
  bol_flip = false;
  var elements = document.getElementById(formID).elements;

  for (var i = 0, element; element = elements[i++];)
  {
    if (element.id.substring(0,4) == 'incl')
    {
      if (bol_flip == true)
      {
        s_srchPairs += ',';
      }
      s_srchPairs += element.id + ':' + element.value;
      bol_flip = true;
    }
  }
  if (s_srchPairs.length >0)
  {
    func_saveSettings();
  }
  return true;
  
}


//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
function func_checkChanged()
{
  if (bol_idChanged==true && bol_formSaved==true)
  {
    window.open('index.html','_self');
  }
  else
  {
    func_ShowAlert('no chage',true);
  }
  
}
</script>




<body onload="">
<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">

  <!-- Layout container -->
  <div class="layout-container">

    <!-- Menu -->
    <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme" onclick="func_checkChanged();">
      <div class="app-brand demo">
        <a href="index.html" class="app-brand-link">
          <span class="app-brand-logo demo">
            <img src="./assets/img/branding/logo.png" class="h-auto" width="40px" alt="logo">
          </span>
          <span class="app-brand-text demo menu-text fw-bold">Advanced ToolBox
            <br />
            <span class="fs-tiny fw-medium opacity-25">for LaunchDarkly</span>
          </span>
        </a>

       
      </div>

      <div class="menu-inner-shadow"></div>

      
    </aside>
    <!--/ Menu -->

    <!-- Layout page -->
    <div class="layout-page">

      <!-- Navbar -->
      <nav
        class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
        id="layout-navbar">

        <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
          <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
            <i class="bx bx-menu bx-sm"></i>
          </a>
        </div>

        <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
          <div class="">
            <div class="nav-item d-flex align-items-center">
              <i class="blockquote">The Advanced ToolBox for a growing extended toolset for the LD platform accross Projects, Environments and Flags...</i>
            </div>
          </div>
        </div>
      </nav>
      <!--/ Navbar -->

      <!-- Content wrapper -->
      <div class="content-wrapper">

        <!-- Content -->
        <div class="container-xxl flex-grow-1 container-p-y">
          <h4 class="fw-bold py-3 mb-4">Settings</h4>
          <!-- ************************ FORM **********************-->

          <form id="frmSettings">
            <table width="100%">  <!-- Spacer and heading-->
              <tr align="left">
                <td style="padding-bottom: 10px;" width="60px"><hr style="height:3px;color:darkolivegreen"></td>
                <td width="10px"></td>
                <TD style="padding-bottom: 10px;"><B style="text-transform: capitalize;">Advanced ToolBox Login</B></TD>
              </tr>
            </table> <!-- // END OF Spacer and heading-->
          
            <div class="mb-3 row"> <!-- user name -->
              <label for="html5-text-input" class="col-md-2 col-form-label">User Name</label>
              <div class="col-md-10">
                <input onchange="bol_idChanged=true" class="form-control" type="text" value="" id="incl_ASuser_nameAS" />
              </div>
            </div>
            
            <div class="mb-3 row"> <!-- password #1-->
              <label for="html5-password-input" class="col-md-2 col-form-label">Password</label>
              <div class="col-md-10">
                <input onchange="bol_idChanged=true" class="form-control" type="text" value="" id="incl_ASpassword_1" />
              </div>
            </div>

            <div class="mb-3 row"> <!-- Logging -->
              <label for="html5-text-input" class="col-md-2 col-form-label">Enable Logging</label>
              <div class="col-md-10">
                <select id="incl_ASlogging" class="form-select">
                  <option value=true>Enabled</option>
                  <option selected value=false>Disabled</option>
                </select>
              </div>
            </div>


            <table width="100%">  <!-- Spacer and heading-->
              <tr align="left">
                <td style="padding-bottom: 10px;" width="60px"><hr style="height:3px;color:darkolivegreen"></td>
                <td width="10px"></td>
                <TD style="padding-bottom: 10px;"><B style="text-transform: capitalize;">Database Information</B></TD>
              </tr>
            </table> <!-- // END OF Spacer and heading-->

            <div class="mb-3 row"> <!-- Database connection -->
              <label for="html5-search-input" class="col-md-2 col-form-label">Database Connection</label>
              <div class="col-md-10">
                <input onblur="func_regexFind(this.value,1,'incl_DBusername');func_regexFind(this.value,2,'incl_DBpassword');" class="form-control" type="search" value="" id="incl_DBconnection" />
              </div>
            </div>

            <div class="mb-3 row"> <!-- database user name -->
              <label for="html5-text-input" class="col-md-2 col-form-label">Database User Name</label>
              <div class="col-md-10">
                <input disabled class="form-control" type="text" value="" id="incl_DBusername" />
              </div>
            </div>

            <div class="mb-3 row"> <!-- database password -->
              <label for="html5-password-input" class="col-md-2 col-form-label">Database Password</label>
              <div class="col-md-10">
                <input disabled class="form-control" type="text" value="" id="incl_DBpassword" />
              </div>
            </div>
            
            <table width="100%">  <!-- Spacer and heading-->
              <tr align="left">
                <td style="padding-bottom: 10px;" width="60px"><hr style="height:3px;color:darkolivegreen"></td>
                <td width="10px"></td>
                <TD style="padding-bottom: 10px;"><B style="text-transform: capitalize;">LaunchDarkly Information</B></TD>
              </tr>
            </table> <!-- // END OF Spacer and heading-->

            <div class="mb-3 row"> <!-- LaunchDarkly Key -->
              <label for="html5-text-input" class="col-md-2 col-form-label">API Key</label>
              <div class="col-md-10">
                <input class="form-control" type="text" value="" id="incl_LDkey" />
              </div>
            </div>
            <div class="mb-3 row"> <!-- LaunchDarkly Key -->
              <label for="html5-text-input" class="col-md-2 col-form-label">Key Name</label>
              <div class="col-md-10">
                <input class="form-control" type="text" value="" id="incl_LDkeyname" />
              </div>
            </div>

            <div align="center" width="100%"><!-- SUBMIT BUtton-->
              <button type="button" class="btn btn-primary me-2" onclick="validate_form('frmSettings');">
                <span class="tf-icons bx bx-pie-chart-alt me-1"></span> Save
              </button>
            </div><!-- //-->
          </form>

          <!-- *****************************************************-->

        </div>

        <!-- Messages DIV-->
        <div class="alert alert-primary d-flex" role="alert" id="divStatus" style="visibility: hidden;">
          <span class="badge badge-center rounded-pill bg-primary border-label-primary p-3 me-2"><i class="bx bx-command fs-6"></i></span>
          <div class="d-flex flex-column ps-1">
            <span id="divStatusText"></span>
          </div>
        </div>
        <div class="alert alert-danger" role="alert"  width="100%" height="15px" style="visibility: hidden;"><B id="divStatusText"></B></div>
        <!-- //Messages DIV-->

        <!--/ Content -->

         <!-- Footer -->
         <footer class="content-footer footer bg-footer-theme">
          <div
            class="container-xxl d-flex flex-wrap justify-content-between align-items-center py-2 flex-md-row flex-column">

            <div class="mb-2 mb-md-0">
              Â©
              <script>
                document.write(new Date().getFullYear());
              </script>
              <a href="#" target="_blank" class="footer-link fw-bolder">ThemeSelection</a>
            </div>
            <div>
              <a href="https://themeselection.com/documentation" target="_blank"
                class="footer-link me-4">Documentation</a>
            </div>
          </div>
        </footer>
        <!--/ Footer -->

        <!-- Content area backdrop -->
        <div class="content-backdrop fade"></div>
      </div>
      <!--/ Content wrapper -->

    </div>
    <!-- Layout page -->

  </div>
  <!-- Layout container -->

  <!-- Overlay -->
  <div class="layout-overlay layout-menu-toggle"></div>

  <!-- Drag Target Area To SlideIn Menu On Small Screens -->
  <div class="drag-target"></div>
</div>
<!--/ Layout wrapper -->

  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="./assets/vendor/libs/jquery/jquery.js"></script>
  <script src="./assets/vendor/libs/popper/popper.js"></script>
  <script src="./assets/vendor/js/bootstrap.js"></script>
  <script src="./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="./assets/vendor/libs/hammer/hammer.js"></script>
  <script src="./assets/vendor/js/menu.js"></script>
  <!-- endbuild -->

  <!-- Main JS -->
  <script src="./assets/js/main.js"></script>
  <script>func_LoadValues();</script>
</body>

</html>
